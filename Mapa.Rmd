---
title: "Untitled"
author: "Lux"
date: "2025-07-22"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, fig.width = 10, fig.height = 8)
```

## 


```{r}
library(ggplot2)
library(dplyr)
library(scales) # Za ljepše formatiranje brojeva na osima
library(patchwork) # Za elegantno spajanje više grafova

```

## Makro pogled na čitav me


```{r}
dta <- readRDS("D:/LUKA/Dropbox/df_all.rds")

# remove titkok from SOURCE_TYPE
dta <- dta %>%
  filter(SOURCE_TYPE != "tiktok") %>%
  mutate(
    SOURCE_TYPE = factor(SOURCE_TYPE, levels = c("web", "youtube", "facebook", "twitter", "reddit", "forum", "comment"))
  )

```


```{r}
platform_summary <- dta %>%
  group_by(year, SOURCE_TYPE) %>%
  summarise(
    total_posts = n(),
    total_interactions = sum(INTERACTIONS, na.rm = TRUE),
    total_reach = sum(REACH, na.rm = TRUE) # Posebno korisno za YouTube/video
  ) %>%
  ungroup() %>%
  arrange(year, desc(total_posts))

# Pregled rezultata
print(platform_summary, n = 20)
```

```{r dpi = 200, fig.width=10, fig.height=8}
platform_colors <- c(
  "web" = "#1f77b4",       # Plava
  "youtube" = "#d62728",    # Crvena
  "facebook" = "#3b5998",   # Facebook plava
  "twitter" = "#1DA1F2",    # Twitter plava
  "tiktok" = "#000000",      # Crna
  "reddit" = "#FF4500",     # Narančasto-crvena
  "forum" = "#7f7f7f",       # Siva
  "comment" = "#bcbd22"     # Maslinasta
)


plot_volume <- platform_summary %>%
  # Sortiramo unutar svake godine da bi graf bio čitljiviji
  arrange(year, total_posts) %>%
  mutate(SOURCE_TYPE_ordered = factor(SOURCE_TYPE, levels = unique(SOURCE_TYPE))) %>%
  ggplot(aes(x = total_posts, y = SOURCE_TYPE_ordered, fill = SOURCE_TYPE)) +
  geom_col() +
  geom_text(aes(label = comma(total_posts, accuracy = 1)), hjust = -0.1, size = 3, color = "black") +
  facet_wrap(~year, scales = "free_y") +
  scale_x_continuous(labels = label_number(suffix = " K", scale = 1e-3)) +
  scale_fill_manual(values = platform_colors) +
  theme_minimal(base_size = 14) +
  theme(
    legend.position = "none",
    strip.text = element_text(face = "bold", size = 16),
    panel.grid.major.y = element_blank(),
    axis.text.x = element_text(angle = 45, hjust = 1)
  ) +
  labs(
    title = "Broj objava po platformama (2021-2024)",
    subtitle = "",
    x = "Ukupan broj objava (u tisućama)",
    y = "Tip platforme",
    caption = "Napomena: Podaci za 2024. su djelomični. Stupci su sortirani po volumenu."
  )


print(plot_volume)



```


```{r dpi = 200, fig.width=10, fig.height=8}
plot_interactions <- platform_summary %>%
  arrange(year, total_interactions) %>%
  mutate(
    SOURCE_TYPE_ordered = factor(SOURCE_TYPE, levels = unique(SOURCE_TYPE))
  ) %>%
  ggplot(aes(x = total_interactions, y = SOURCE_TYPE_ordered, fill = SOURCE_TYPE)) +
  geom_col() +
  geom_text(
    aes(label = comma(total_interactions, accuracy = 1)),
    hjust = -0.1, size = 3, color = "black"
  ) +
  facet_wrap(~year, scales = "free_y") +
  # if your interactions run into the millions, scale accordingly
  scale_x_continuous(
    labels = label_number(suffix = " M", scale = 1e-6)
  ) +
  scale_fill_manual(values = platform_colors) +
  theme_minimal(base_size = 14) +
  theme(
    legend.position    = "none",
    strip.text         = element_text(face = "bold", size = 16),
    panel.grid.major.y = element_blank(),
    axis.text.x        = element_text(angle = 45, hjust = 1)
  ) +
  labs(
    title    = "Ukupan broj interakcija po platformama (2021–2024)",
    x        = "Interakcije (u milijunima)",
    y        = "Tip platforme",
    caption  = "Napomena: Podaci za 2024. su djelomični. Stupci su sortirani po volumenu."
  )

print(plot_interactions)
```



```{r dpi = 200, fig.width=10, fig.height=8}
plot_reach <- platform_summary %>%
  arrange(year, total_reach) %>%
  mutate(
    SOURCE_TYPE_ordered = factor(SOURCE_TYPE, levels = unique(SOURCE_TYPE))
  ) %>%
  ggplot(aes(x = total_reach, y = SOURCE_TYPE_ordered, fill = SOURCE_TYPE)) +
  geom_col() +
  geom_text(
    aes(label = comma(total_reach, accuracy = 1)),
    hjust = -0.1, size = 3, color = "black"
  ) +
  facet_wrap(~year, scales = "free_y") +
  # likewise, adjust scale/suffix if reach is in thousands vs. millions
  scale_x_continuous(
    labels = label_number(suffix = " M", scale = 1e-6)
  ) +
  scale_fill_manual(values = platform_colors) +
  theme_minimal(base_size = 14) +
  theme(
    legend.position    = "none",
    strip.text         = element_text(face = "bold", size = 16),
    panel.grid.major.y = element_blank(),
    axis.text.x        = element_text(angle = 45, hjust = 1)
  ) +
  labs(
    title    = "Ukupan doseg po platformama (2021–2024)",
    x        = "Doseg (u milijunima)",
    y        = "Tip platforme",
    caption  = "Napomena: Podaci za 2024. su djelomični. Stupci su sortirani po volumenu."
  )

print(plot_reach)
```



```{r dpi = 200, fig.width=10, fig.height=8}
proportions_summary <- platform_summary %>%
  group_by(year) %>%
  mutate(
    post_share        = total_posts / sum(total_posts),
    interaction_share = total_interactions / sum(total_interactions),
    reach_share       = total_reach / sum(total_reach)
  ) %>%
  ungroup()

# 2) Graf za udio u objavama
plot_share_posts <- proportions_summary %>%
  ggplot(aes(x = year, y = post_share, fill = SOURCE_TYPE)) +
  geom_col(position = "fill") +
  scale_y_continuous(labels = percent_format()) +
  scale_x_continuous(breaks = c(2021, 2022, 2023, 2024)) +
  scale_fill_manual(values = platform_colors) +
  theme_minimal(base_size = 14) +
  labs(
    title = "Udio objava",
    x     = "Godina",
    y     = "Postotak"
  )

# 3) Graf za udio u interakcijama
plot_share_interactions <- proportions_summary %>%
  filter(total_interactions > 0) %>%
  ggplot(aes(x = year, y = interaction_share, fill = SOURCE_TYPE)) +
  geom_col(position = "fill") +
  scale_y_continuous(labels = percent_format()) +
  scale_x_continuous(breaks = c(2021, 2022, 2023, 2024)) +
  scale_fill_manual(values = platform_colors, guide = "none") +
  theme_minimal(base_size = 14) +
  labs(
    title = "Udio interakcija",
    x     = "",
    y     = "Postotak"
  )

# 4) Graf za udio u dosegu
plot_share_reach <- proportions_summary %>%
  filter(total_reach > 0) %>%
  ggplot(aes(x = year, y = reach_share, fill = SOURCE_TYPE)) +
  geom_col(position = "fill") +
  scale_y_continuous(labels = percent_format()) +
  scale_x_continuous(breaks = c(2021, 2022, 2023, 2024)) +
  scale_fill_manual(values = platform_colors, guide = "none") +
  theme_minimal(base_size = 14) +
  labs(
    title = "Udio dosega",
    x     = "",
    y     = "Postotak"
  )

# 5) Spojimo sve tri u jedan prikaz
plot_combined_share <- (
    plot_share_posts + plot_share_interactions + plot_share_reach
  ) +
  plot_layout(guides = 'collect') +
  plot_annotation(
    title    = "Struktura digitalnog ekosustava (2021–2024)",
    subtitle = "Lijevo: objave ─ Sredina: interakcije ─ Desno: doseg",
    caption  = "Web generira najviše sadržaja, ali YouTube preuzima sve veći dio interakcija i dosega."
  )

print(plot_combined_share)
```


```{r}
source_summary <- dta %>%
  filter(!is.na(FROM)) %>%
  group_by(year, FROM) %>%
  summarise(
    productivity = n(), # Broj objava
    total_interactions = sum(INTERACTIONS, na.rm = TRUE), # Ukupan angažman
    avg_engagement_rate = mean(ENGAGEMENT_RATE, na.rm = TRUE), # Prosječna stopa angažmana
    total_reach = sum(REACH, na.rm = TRUE) # Ukupan doseg
  ) %>%
  ungroup()

# Identificiramo Top 15 izvora po godini na temelju ukupnih interakcija
top_sources_by_year <- source_summary %>%
  group_by(year) %>%
  slice_max(order_by = total_interactions, n = 15) %>%
  ungroup() %>%
  arrange(year, desc(total_interactions))

# Pregled rezultata
print(top_sources_by_year, n = 60) # Prikazujemo više redaka da vidimo rezultate za sve godine
```

```{r dpi = 200, fig.width=10, fig.height=8}
plot_interactions <- platform_summary %>%
  filter(total_interactions > 0) %>%
  ggplot(aes(x = total_interactions, y = reorder(SOURCE_TYPE, total_interactions), fill = SOURCE_TYPE)) +
  geom_col() +
  facet_wrap(~year) +
  scale_x_continuous(labels = label_number(suffix = " M", scale = 1e-6)) +
  scale_fill_manual(values = platform_colors, guide = "none") + # Skrivamo legendu jer je redundantna
  theme_light(base_size = 14) +
  theme(
    strip.text = element_text(face = "bold", size = 16),
    panel.grid.major.y = element_blank()
  ) +
  labs(
    title = "Angažman publike po platformama (2021-2024)",
    subtitle = "",
    x = "Ukupne interakcije (u milijunima)",
    y = "Tip platforme",
    caption = "Napomena: Prikazane su samo platforme s zabilježenim interakcijama."
  )


print(plot_interactions)
```



```{r}
# Koristimo 'df_all' koji smo kreirali u prvom koraku
# (spojeni df_2021, df_2022, itd.)
# Pretpostavljam da je taj objekt još uvijek u vašem R okruženju.

# Filtriranje i agregacija za WEB portale
top_web_sources <- dta %>%
  filter(SOURCE_TYPE == "web" & !is.na(FROM)) %>%
  group_by(FROM) %>%
  summarise(
    total_posts = n(),
    total_interactions = sum(INTERACTIONS, na.rm = TRUE)
  ) %>%
  ungroup() %>%
  slice_max(order_by = total_interactions, n = 20) %>%
  arrange(total_interactions) %>% # Sortiramo uzlazno za bolji vizualni prikaz u ggplotu
  mutate(FROM = factor(FROM, levels = FROM)) # Pretvaramo 'FROM' u faktor da zadržimo redoslijed

# Filtriranje i agregacija za YOUTUBE kanale
top_youtube_sources <- dta %>%
  filter(SOURCE_TYPE == "youtube" & !is.na(FROM)) %>%
  group_by(FROM) %>%
  summarise(
    total_posts = n(),
    total_interactions = sum(INTERACTIONS, na.rm = TRUE)
  ) %>%
  ungroup() %>%
  slice_max(order_by = total_interactions, n = 20) %>%
  arrange(total_interactions) %>%
  mutate(FROM = factor(FROM, levels = FROM))

# Filtriranje i agregacija za FACEBOOK stranice
top_facebook_sources <- dta %>%
  filter(SOURCE_TYPE == "facebook" & !is.na(FROM)) %>%
  group_by(FROM) %>%
  summarise(
    total_posts = n(),
    total_interactions = sum(INTERACTIONS, na.rm = TRUE)
  ) %>%
  ungroup() %>%
  slice_max(order_by = total_interactions, n = 20) %>%
  arrange(total_interactions) %>%
  mutate(FROM = factor(FROM, levels = FROM))
```


```{r dpi = 200, fig.width=10, fig.height=8}
# Funkcija koja stvara 'lollipop' graf
create_top_source_plot <- function(data, platform_name, platform_color) {
  
  # Provjera je li data frame prazan
  if(nrow(data) == 0) {
    return(
      ggplot() + 
      labs(title = paste("Nema dostupnih podataka za", platform_name)) +
      theme_void()
    )
  }
  
  ggplot(data, aes(x = FROM, y = total_interactions)) +
    # Stvara liniju "lizalice"
    geom_segment(aes(x = FROM, xend = FROM, y = 0, yend = total_interactions), 
                 color = "grey", linewidth = 0.5) +
    # Stvara točku na vrhu, veličina mapirana na broj objava
    geom_point(aes(size = total_posts), color = platform_color, alpha = 0.8) +
    # Okrećemo koordinate za bolju čitljivost imena
    coord_flip() +
    # Ljepše formatiranje brojeva na osi
    scale_y_continuous(labels = label_number(suffix = " K", scale = 1e-3)) +
    # Legenda za veličinu točke
    scale_size_continuous(range = c(2, 10), name = "Broj objava") +
    # Tema i naslovi
    theme_light(base_size = 12) +
    theme(
      panel.grid.major.y = element_blank(),
      panel.border = element_blank(),
      axis.ticks.y = element_blank(),
      legend.position = "bottom"
    ) +
    labs(
      title = platform_name,
      x = "",
      y = "Ukupne interakcije (u tisućama)"
    )
}



# Kreiramo svaki pojedinačni graf
plot_web <- create_top_source_plot(top_web_sources, "Web Portali", "#1f77b4")
plot_youtube <- create_top_source_plot(top_youtube_sources, "YouTube Kanali", "#d62728")
plot_facebook <- create_top_source_plot(top_facebook_sources, "Facebook Stranice", "#3b5998")

# Spajamo ih u jednu veliku vizualizaciju
final_dashboard <- plot_web + plot_youtube + plot_facebook +
  plot_annotation(
    title = "Top 20 Aktera u Ključnim Digitalnim Ekosustavima (2021-2024)",
    subtitle = "Rangirano prema ukupnim interakcijama. Veličina točke predstavlja ukupan broj objava.",
    caption = "Izvor: Analiza projekta 'Prikaz i analiza katoličke tematike u digitalnom medijskom prostoru'",
    theme = theme(plot.title = element_text(size = 20, face = "bold"))
  )

# Prikazujemo konačni dashboard
print(final_dashboard)
```






```{r}

# Instalirajte ggrepel ako ga nemate
# install.packages("ggrepel")

library(ggplot2)
library(dplyr)
library(scales)
library(patchwork)
library(ggrepel) # Naš novi alat za lijepe labele

# --- Pretpostavljamo da je 'df_all' i dalje u vašem okruženju ---

# Funkcija za dohvaćanje najvažnijih aktera
# Uzimamo top 15 po interakcijama I top 15 po dosegu, te ih spajamo
# kako ne bismo propustili nekog tko je jak samo u jednoj dimenziji.
get_top_actors <- function(data, platform_filter) {
  
  platform_data <- data %>%
    filter(SOURCE_TYPE == platform_filter & !is.na(FROM)) %>%
    group_by(FROM) %>%
    summarise(
      total_posts = n(),
      total_interactions = sum(INTERACTIONS, na.rm = TRUE),
      total_reach = sum(REACH, na.rm = TRUE)
    ) %>%
    ungroup()

  # Ako nema podataka, vrati prazan dataframe
  if(nrow(platform_data) == 0) return(platform_data)
  
  # Pronađi top 15 po interakcijama
  top_by_interactions <- platform_data %>%
    slice_max(order_by = total_interactions, n = 15)
  
  # Pronađi top 15 po dosegu
  top_by_reach <- platform_data %>%
    slice_max(order_by = total_reach, n = 15)
    
  # Spoji ih i ukloni duplikate
  combined_top <- bind_rows(top_by_interactions, top_by_reach) %>%
    distinct(FROM, .keep_all = TRUE)
    
  return(combined_top)
}

# Primijenimo funkciju na naše tri platforme
web_actors <- get_top_actors(dta, "web")
youtube_actors <- get_top_actors(dta, "youtube")
facebook_actors <- get_top_actors(dta, "facebook")

```



```{r}
create_actor_map_plot <- function(data, platform_name, platform_color) {
  
  # Provjera je li data frame prazan
  if(nrow(data) < 2) {
    return(
      ggplot() + 
      labs(title = paste("Nema dovoljno podataka za", platform_name)) +
      theme_void()
    )
  }
  
  # Izračunaj medijane za iscrtavanje linija kvadranata
  median_interactions <- median(data$total_interactions, na.rm = TRUE)
  median_reach <- median(data$total_reach, na.rm = TRUE)

  ggplot(data, aes(x = total_interactions, y = total_reach)) +
    # Linije koje dijele graf u 4 kvadranta (na temelju medijana)
    geom_vline(xintercept = median_interactions, linetype = "dashed", color = "grey70") +
    geom_hline(yintercept = median_reach, linetype = "dashed", color = "grey70") +
    
    # Točke koje predstavljaju aktere
    geom_point(aes(size = total_posts), color = platform_color, alpha = 0.7) +
    
    # Inteligentne labele koje se ne preklapaju
    geom_text_repel(aes(label = FROM), size = 3, max.overlaps = 15) +
    
    # Korištenje logaritamske skale za bolju distribuciju točaka
    scale_x_log10(labels = label_number(big.mark = ".", suffix = " K", scale = 1e-3)) +
    scale_y_log10(labels = label_number(big.mark = ".", suffix = " M", scale = 1e-6)) +
    
    scale_size_continuous(range = c(2, 12), name = "Broj objava") +
    theme_minimal(base_size = 12) +
    theme(legend.position = "bottom") +
    labs(
      title = platform_name,
      x = "Ukupne interakcije (Log skala)",
      y = "Ukupan doseg (Log skala)"
    )
}

plot_map_web <- create_actor_map_plot(web_actors, "Web Portali", "#1f77b4")
plot_map_youtube <- create_actor_map_plot(youtube_actors, "YouTube Kanali", "#d62728")
plot_map_facebook <- create_actor_map_plot(facebook_actors, "Facebook Stranice", "#3b5998")

# Spajamo ih u jednu veliku vizualizaciju
final_map_dashboard <- plot_map_web + plot_map_youtube + plot_map_facebook +
  plot_annotation(
    title = "Mapa Utjecaja Aktera u Ključnim Digitalnim Ekosustavima (2021-2024)",
    subtitle = "Usporedba dosega (reach) i angažmana (interactions). Veličina točke predstavlja produktivnost (broj objava).",
    caption = "Izvor: Analiza projekta 'Prikaz i analiza katoličke tematike u digitalnom medijskom prostoru' | Osi su na logaritamskoj skali.",
    theme = theme(plot.title = element_text(size = 20, face = "bold"))
  ) & theme(plot.background = element_rect(fill = "white", color = NA)) # Osigurava bijelu pozadinu za svaki graf

# Prikazujemo konačni dashboard
print(final_map_dashboard)



```




