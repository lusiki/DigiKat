---
title: "Untitled"
author: "Lux"
date: "2025-07-22"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, fig.width = 10, fig.height = 8)
```

## 


```{r}
library(ggplot2)
library(dplyr)
library(scales) # Za ljepše formatiranje brojeva na osima
library(patchwork) # Za elegantno spajanje više grafova

```

## 


```{r}
dta <- readRDS("D:/LUKA/Dropbox/df_all.rds")

# remove titkok from SOURCE_TYPE
dta <- dta %>%
  filter(SOURCE_TYPE != "tiktok") %>%
  mutate(
    SOURCE_TYPE = factor(SOURCE_TYPE, levels = c("web", "youtube", "facebook", "twitter", "reddit", "forum", "comment"))
  )

```


```{r}
platform_summary <- dta %>%
  group_by(year, SOURCE_TYPE) %>%
  summarise(
    total_posts = n(),
    total_interactions = sum(INTERACTIONS, na.rm = TRUE),
    total_reach = sum(REACH, na.rm = TRUE) # Posebno korisno za YouTube/video
  ) %>%
  ungroup() %>%
  arrange(year, desc(total_posts))

# Pregled rezultata
print(platform_summary, n = 20)
```

```{r dpi = 200, fig.width=10, fig.height=8}
platform_colors <- c(
  "web" = "#1f77b4",       # Plava
  "youtube" = "#d62728",    # Crvena
  "facebook" = "#3b5998",   # Facebook plava
  "twitter" = "#1DA1F2",    # Twitter plava
  "tiktok" = "#000000",      # Crna
  "reddit" = "#FF4500",     # Narančasto-crvena
  "forum" = "#7f7f7f",       # Siva
  "comment" = "#bcbd22"     # Maslinasta
)


plot_volume <- platform_summary %>%
  # Sortiramo unutar svake godine da bi graf bio čitljiviji
  arrange(year, total_posts) %>%
  mutate(SOURCE_TYPE_ordered = factor(SOURCE_TYPE, levels = unique(SOURCE_TYPE))) %>%
  ggplot(aes(x = total_posts, y = SOURCE_TYPE_ordered, fill = SOURCE_TYPE)) +
  geom_col() +
  geom_text(aes(label = comma(total_posts, accuracy = 1)), hjust = -0.1, size = 3, color = "black") +
  facet_wrap(~year, scales = "free_y") +
  scale_x_continuous(labels = label_number(suffix = " K", scale = 1e-3)) +
  scale_fill_manual(values = platform_colors) +
  theme_minimal(base_size = 14) +
  theme(
    legend.position = "none",
    strip.text = element_text(face = "bold", size = 16),
    panel.grid.major.y = element_blank(),
    axis.text.x = element_text(angle = 45, hjust = 1)
  ) +
  labs(
    title = "Broj objava po platformama (2021-2024)",
    subtitle = "",
    x = "Ukupan broj objava (u tisućama)",
    y = "Tip platforme",
    caption = "Napomena: Podaci za 2024. su djelomični. Stupci su sortirani po volumenu."
  )


print(plot_volume)



```


```{r dpi = 200, fig.width=10, fig.height=8}
plot_interactions <- platform_summary %>%
  arrange(year, total_interactions) %>%
  mutate(
    SOURCE_TYPE_ordered = factor(SOURCE_TYPE, levels = unique(SOURCE_TYPE))
  ) %>%
  ggplot(aes(x = total_interactions, y = SOURCE_TYPE_ordered, fill = SOURCE_TYPE)) +
  geom_col() +
  geom_text(
    aes(label = comma(total_interactions, accuracy = 1)),
    hjust = -0.1, size = 3, color = "black"
  ) +
  facet_wrap(~year, scales = "free_y") +
  # if your interactions run into the millions, scale accordingly
  scale_x_continuous(
    labels = label_number(suffix = " M", scale = 1e-6)
  ) +
  scale_fill_manual(values = platform_colors) +
  theme_minimal(base_size = 14) +
  theme(
    legend.position    = "none",
    strip.text         = element_text(face = "bold", size = 16),
    panel.grid.major.y = element_blank(),
    axis.text.x        = element_text(angle = 45, hjust = 1)
  ) +
  labs(
    title    = "Ukupan broj interakcija po platformama (2021–2024)",
    x        = "Interakcije (u milijunima)",
    y        = "Tip platforme",
    caption  = "Napomena: Podaci za 2024. su djelomični. Stupci su sortirani po volumenu."
  )

print(plot_interactions)
```



```{r dpi = 200, fig.width=10, fig.height=8}
plot_reach <- platform_summary %>%
  arrange(year, total_reach) %>%
  mutate(
    SOURCE_TYPE_ordered = factor(SOURCE_TYPE, levels = unique(SOURCE_TYPE))
  ) %>%
  ggplot(aes(x = total_reach, y = SOURCE_TYPE_ordered, fill = SOURCE_TYPE)) +
  geom_col() +
  geom_text(
    aes(label = comma(total_reach, accuracy = 1)),
    hjust = -0.1, size = 3, color = "black"
  ) +
  facet_wrap(~year, scales = "free_y") +
  # likewise, adjust scale/suffix if reach is in thousands vs. millions
  scale_x_continuous(
    labels = label_number(suffix = " M", scale = 1e-6)
  ) +
  scale_fill_manual(values = platform_colors) +
  theme_minimal(base_size = 14) +
  theme(
    legend.position    = "none",
    strip.text         = element_text(face = "bold", size = 16),
    panel.grid.major.y = element_blank(),
    axis.text.x        = element_text(angle = 45, hjust = 1)
  ) +
  labs(
    title    = "Ukupan doseg po platformama (2021–2024)",
    x        = "Doseg (u milijunima)",
    y        = "Tip platforme",
    caption  = "Napomena: Podaci za 2024. su djelomični. Stupci su sortirani po volumenu."
  )

print(plot_reach)
```



```{r}
proportions_summary <- platform_summary %>%
  group_by(year) %>%
  mutate(
    post_share        = total_posts / sum(total_posts),
    interaction_share = total_interactions / sum(total_interactions),
    reach_share       = total_reach / sum(total_reach)
  ) %>%
  ungroup()

# 2) Graf za udio u objavama
plot_share_posts <- proportions_summary %>%
  ggplot(aes(x = year, y = post_share, fill = SOURCE_TYPE)) +
  geom_col(position = "fill") +
  scale_y_continuous(labels = percent_format()) +
  scale_x_continuous(breaks = c(2021, 2022, 2023, 2024)) +
  scale_fill_manual(values = platform_colors) +
  theme_minimal(base_size = 14) +
  labs(
    title = "Udio objava",
    x     = "Godina",
    y     = "Postotak"
  )

# 3) Graf za udio u interakcijama
plot_share_interactions <- proportions_summary %>%
  filter(total_interactions > 0) %>%
  ggplot(aes(x = year, y = interaction_share, fill = SOURCE_TYPE)) +
  geom_col(position = "fill") +
  scale_y_continuous(labels = percent_format()) +
  scale_x_continuous(breaks = c(2021, 2022, 2023, 2024)) +
  scale_fill_manual(values = platform_colors, guide = "none") +
  theme_minimal(base_size = 14) +
  labs(
    title = "Udio interakcija",
    x     = "",
    y     = "Postotak"
  )

# 4) Graf za udio u dosegu
plot_share_reach <- proportions_summary %>%
  filter(total_reach > 0) %>%
  ggplot(aes(x = year, y = reach_share, fill = SOURCE_TYPE)) +
  geom_col(position = "fill") +
  scale_y_continuous(labels = percent_format()) +
  scale_x_continuous(breaks = c(2021, 2022, 2023, 2024)) +
  scale_fill_manual(values = platform_colors, guide = "none") +
  theme_minimal(base_size = 14) +
  labs(
    title = "Udio dosega",
    x     = "",
    y     = "Postotak"
  )

# 5) Spojimo sve tri u jedan prikaz
plot_combined_share <- (
    plot_share_posts + plot_share_interactions + plot_share_reach
  ) +
  plot_layout(guides = 'collect') +
  plot_annotation(
    title    = "Struktura digitalnog ekosustava (2021–2024)",
    subtitle = "Lijevo: objave ─ Sredina: interakcije ─ Desno: doseg",
    caption  = "Web generira najviše sadržaja, ali YouTube preuzima sve veći dio interakcija i dosega."
  )

print(plot_combined_share)
```


```{r}
source_summary <- dta %>%
  filter(!is.na(FROM)) %>%
  group_by(year, FROM) %>%
  summarise(
    productivity = n(), # Broj objava
    total_interactions = sum(INTERACTIONS, na.rm = TRUE), # Ukupan angažman
    avg_engagement_rate = mean(ENGAGEMENT_RATE, na.rm = TRUE), # Prosječna stopa angažmana
    total_reach = sum(REACH, na.rm = TRUE) # Ukupan doseg
  ) %>%
  ungroup()

# Identificiramo Top 15 izvora po godini na temelju ukupnih interakcija
top_sources_by_year <- source_summary %>%
  group_by(year) %>%
  slice_max(order_by = total_interactions, n = 15) %>%
  ungroup() %>%
  arrange(year, desc(total_interactions))

# Pregled rezultata
print(top_sources_by_year, n = 60) # Prikazujemo više redaka da vidimo rezultate za sve godine
```

```{r }
plot_interactions <- platform_summary %>%
  filter(total_interactions > 0) %>%
  ggplot(aes(x = total_interactions, y = reorder(SOURCE_TYPE, total_interactions), fill = SOURCE_TYPE)) +
  geom_col() +
  facet_wrap(~year) +
  scale_x_continuous(labels = label_number(suffix = " M", scale = 1e-6)) +
  scale_fill_manual(values = platform_colors, guide = "none") + # Skrivamo legendu jer je redundantna
  theme_light(base_size = 14) +
  theme(
    strip.text = element_text(face = "bold", size = 16),
    panel.grid.major.y = element_blank()
  ) +
  labs(
    title = "Angažman publike po platformama (2021-2024)",
    subtitle = "",
    x = "Ukupne interakcije (u milijunima)",
    y = "Tip platforme",
    caption = "Napomena: Prikazane su samo platforme s zabilježenim interakcijama."
  )


print(plot_interactions)
```


















