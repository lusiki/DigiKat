---
title: "Emocionalna i konfliktna mapa katoličkog digitalnog prostora"
date: last-modified
format:
  html:
    theme: cosmo
    toc: true
    toc-location: left
    toc-depth: 3
    toc-expand: 2
    smooth-scroll: true
    code-fold: true
    code-tools: false
---

```{r}
#| label: setup
#| include: false

# Globalne postavke
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  warning = FALSE,
  fig.width = 12,
  fig.height = 7,
  dpi = 200
)
```

```{r}
#| label: libraries
#| include: false

# Učitavanje svih potrebnih paketa
library(scales)
library(patchwork)
library(dplyr)
library(tidytext)
library(stringr)
library(ggplot2)
library(forcats)
library(tidyr)
library(widyr)
library(ggraph)
library(igraph)
library(data.table)
library(readxl)
library(ggrepel)
```

```{r}
#| label: load-lexicons

# FAZA 1: UČITAVANJE I PRIPREMA SVIH LEKSIKONA
# Ovaj chunk učitava sve potrebne jezične resurse i pretvara ih u uredan (tidy)
# format spreman za spajanje s lingvističkim podacima.
# Ključni koraci su forsiranje UTF-8 kodiranja i standardizacija formata.

# 1.1: CroSentilex (fina skala sentimenata)
# Učitavamo pozitivne i negativne liste i odmah ih spajamo u jedan leksikon
# sa standardiziranom numeričkom skalom.
crosentilex_full <- bind_rows(
  # Učitavanje negativnih riječi
  read.delim("C:/Users/lsikic/Dropbox/Mislav@Luka/crosentilex-negatives.txt",
             header = FALSE, sep = " ", stringsAsFactors = FALSE, fileEncoding = "UTF-8") %>%
    rename(word = "V1", sentiment_value = "V2") %>%
    mutate(sentiment_value = -sentiment_value), # Pretvaramo score u negativan
  
  # Učitavanje pozitivnih riječi
  read.delim("C:/Users/lsikic/Dropbox/Mislav@Luka//crosentilex-positives.txt",
             header = FALSE, sep = " ", stringsAsFactors = FALSE, fileEncoding = "UTF-8") %>%
    rename(word = "V1", sentiment_value = "V2") # Score je već pozitivan
) %>%
  as_tibble() # Pretvaramo u tibble radi bolje konzistentnosti

# 1.2: CroSentilex-Gold (kategorički sentiment)
# Učitavamo zlatni standard i pretvaramo tekstualne oznake u numeričku skalu
crosentilex_gold_prepared <- read.delim2("C:/Users/lsikic/Dropbox/Mislav@Luka/gs-sentiment-annotations.txt",
                                         header = FALSE, sep = " ", stringsAsFactors = FALSE, fileEncoding = "UTF-8") %>%
  rename(word = "V1", sentiment_str = "V2") %>%
  mutate(
    sentiment_value = case_when(
      sentiment_str == "+" ~ 1,
      sentiment_str == "-" ~ -1,
      TRUE ~ 0
    )
  ) %>%
  select(word, sentiment_value) %>%
  as_tibble()

# 1.3: NRC Leksikon Emocija (za psihološke procese)
# Učitavamo NRC leksikon, pretvaramo ga u dugi format i prevodimo na hrvatski.
nrc_lexicon_raw <- read_excel("C:/Users/lsikic/Dropbox/Mislav@Luka/lilaHR_clean.xlsx", sheet = "Sheet1") %>% 
                   select(-"...1") %>%
                   rename(word = HR)

# Rječnik za prevođenje engleskih naziva emocija
emotion_translator_hr <- c(
  "Anger" = "Ljutnja", "Anticipation" = "Iščekivanje", "Disgust" = "Gađenje",
  "Fear" = "Strah", "Joy" = "Radost", "Sadness" = "Tuga",
  "Surprise" = "Iznenađenje", "Trust" = "Povjerenje"
)

# Transformacija u dugi, prevedeni format
nrc_lexicon_long <- nrc_lexicon_raw %>% 
  pivot_longer(
    cols = all_of(names(emotion_translator_hr)), # Koristimo samo 8 glavnih emocija
    names_to = "emotion",
    values_to = "value"
  ) %>%
  filter(value == 1) %>% # Zadržavamo samo postojeće veze riječ-emocija
  mutate(emotion = recode(emotion, !!!emotion_translator_hr)) %>% # Prevodimo na hrvatski
  select(word, emotion)
```

```{r}
#| label: data-preparation

dta <- readRDS("C:/Users/lsikic/Luka C/HKS/Projekti/Digitalni Kat/SHKM/Podatci/df_all.rds")

# Kreiranje stratificiranog uzorka od 5%
sample_proportion <- 0.05
set.seed(123)
dta_stratified_sample <- dta %>%
  filter(nchar(FULL_TEXT) > 100) %>%
  group_by(year, SOURCE_TYPE) %>%
  slice_sample(prop = sample_proportion) %>%
  ungroup() %>%
  mutate(doc_id = row_number())

# Učitavanje i filtriranje lingvističkih podataka
files <- list.files("C:/Users/lsikic/Luka C/HKS/Projekti/Digitalni Kat/SHKM/Podatci/Language model", full.names = TRUE, pattern = "\\.rds")
nlp_results_df <- lapply(files, readRDS) %>%
  bind_rows()

# Provjeri postoji li doc_id kolona, ako ne, kreiraj je
if (!"doc_id" %in% names(nlp_results_df)) {
  nlp_results_df <- nlp_results_df %>%
    mutate(doc_id = row_number())
} else {
  nlp_results_df <- nlp_results_df %>%
    mutate(doc_id = as.integer(doc_id))
}

# Filtriramo samo dokumente iz našeg uzorka
nlp_results_df <- nlp_results_df %>%
  filter(doc_id %in% dta_stratified_sample$doc_id)

# Tematska klasifikacija
thematic_dictionaries_v3 <- list(
  DUHOVNOST_I_LITURGIJA = c("molitv", "mis", "euharistij", "sakrament", "duhovn", "vjer", "blagoslov", "gosp", "hodočašć", "propovijed", "klanjanj", "zornic", "liturgij", "advent", "korizm", "blagdan", "svetkovin", "krunic", "brevijar", "duhovne vježbe"),
  TEOLOGIJA_I_DOKTRINA = c("teologij", "dogm", "eshatologij", "kristologij", "trojstv", "grijeh", "spasenje", "opravdanje", "moral", "krštenje", "biblija", "sveto pismo", "evanđelj"),
  CRKVENO_UPRAVLJANJE_I_STRUKTURA = c("crkv", "biskup", "nadbiskup", "kardinal", "sveta stolica", "hbk", "žup", "svećenic", "kler", "redovnik", "časna sestra", "laik", "dekanat", "biskupija"),
  PAPE_I_VATIKAN = c("papa franjo", "benedikt xvi", "ivan pavao ii", "vatikan", "dikasterij", "enciklik", "sinodalni put", "sveti otac", "konklav", "apostolsk"),
  CRKVENE_FINANCIJE_I_IMOVINA = c("financij", "imovin", "novac", "proračun", "porez", "restitucij", "ugovor sa svetom stolicom", "nekretnin", "donacij", "milodar"),
  GLOBALNA_CRKVA_I_MISIJE = c("misije", "misionar", "progonjeni kršćani", "svjetski dan mladih", "afrik", "azij", "južna amerik", "svjetska crkva", "papinsk"),
  POLITIKA_I_ODNOS_S_DRZAVOM = c("izbor", "vlada", "strank", "hdz", "sdp", "sabor", "zakon", "predsjednik", "politi", "europ", "milanović", "plenković", "ustav", "sekularnost", "vjeronauk u školi"),
  BIOETIKA_I_KULTURNI_RATOVI = c("obitelj", "život", "pobačaj", "abortus", "brak", "roditelj", "djec", "spol", "rodn", "hod za život", "lgbt", "istospoln", "eutanazij", "transrodnost", "medicinski potpomognuta oplodnja", "palijativna skrb"),
  KARITAS_I_SOCIJALNA_PRAVDA = c("caritas", "pomoć", "siromaš", "siroma", "humanitar", "solidarn", "socijaln", "izbjeglic", "potres", "volonter", "socijalni nauk", "ekologij", "laudato si'", "migranti", "pravednost"),
  POVIJEST_I_NACIONALNI_IDENTITET = c("stepinac", "rat", "komuniz", "jugoslavij", "žrtv", "povijest", "branitelj", "lustracij", "domovinsk", "ustaš", "partizan", "bleiburg", "vukovar", "nacionalni identitet"),
  ZNANOST_I_VJERA = c("znanost", "evolucij", "stvaranje", "bioetik", "umjetna inteligencija", "svemir", "psihologij", "vjera i razum"),
  MEDIJI_UMJETNOST_I_KULTURA = c("medij", "film", "glazb", "umjetnost", "književnost", "kazališt", "arhitektur", "sakraln", "kultura", "koncert", "izložb"),
  DIGITALNA_EVANGELIZACIJA_I_MLADI = c("digitaln", "internet", "društvene mreže", "mladi", "pastoral mladih", "influencer", "podcast", "aplikacij", "evangelizacij", "susret hrvatske katoličke mladeži"),
  ZLOSTAVLJANJE_I_KRIZA_POVJERENJA = c("zlostavljan", "pedofilij", "skandal", "prikrivan", "nulta tolerancija", "žrtv", "susret sa žrtvama"),
  UNUTARCRKVENI_PRIJEPORI_I_IDEOLOGIJE = c("tradicionalist", "progresiv", "konzervativ", "liberal", "karizmatik", "lefebvrovci", "tradicijska misa", "aggiornamento", "hermeneutik", "pluraliz"),
  ODNOS_S_DRUGIM_RELIGIJAMA_I_POGLEDIMA = c("ekumeniz", "međureligijsk", "dijalog", "islam", "pravoslavn", "protestant", "judaiz", "ateiz", "agnosticiz")
)

# Definicija funkcije za izračun scoreova
calculate_theme_scores <- function(text, dictionaries) {
  text_lower <- tolower(text)
  total_words <- str_count(text_lower, "\\w+")
  if (total_words == 0) return(NULL)
  scores <- purrr::map(dictionaries, ~sum(str_count(text_lower, .x)))
  normalized_scores <- purrr::map(scores, ~(.x / total_words) * 1000)
  names(normalized_scores) <- paste0("norm_", names(scores))
  scores_vec <- unlist(scores)
  if(all(scores_vec == 0)){
    dominant_topic <- "Nema Teme"
  } else {
    dominant_topic <- names(scores)[which.max(scores_vec)]
  }
  return(c(as.list(scores), as.list(normalized_scores), dominant_topic = dominant_topic))
}

# Primjena funkcije i stvaranje finalnog obogaćenog dataseta
theme_analysis_data <- purrr::map_dfr(dta_stratified_sample$FULL_TEXT, ~calculate_theme_scores(., thematic_dictionaries_v3))
dta_enriched <- bind_cols(dta_stratified_sample, theme_analysis_data)
```

## Uvod

Nakon što smo mapirali tko govori i o čemu, ova treća faza analize bavi se najsuptilnijim, ali možda i najvažnijim pitanjem kakva je atmosfera digitalnog diskursa? Zanima nas kako se o temama govori s kojim emocionalnim tonom, kojim psihološkim apelima i s kojim intenzitetom konflikta.

Ovaj izvještaj uvodi inovativne, kontekstualno svjesne metrike za mjerenje atmosfere, odmičući se od jednostavnih kategorija prema dubinskom razumijevanju komunikacijskih strategija. Naš pristup sastoji se od tri koraka.

1. Dvoslojna emocionalna analiza: Razdvajamo površinski tonalitet od dubinskih psiholoških procesa.
2. Relativni indeks konflikta (RCI): Mjerimo neočekivanu agresivnost jezika.
3. Mapa narativne atmosfere: Vizualiziramo kako se atmosfera mijenja kada se teme spoje.

---

## Dvoslojna emocionalna analiza Tonalitet vs. psihologija

Da bismo razumjeli atmosferu, moramo razlikovati dvije stvari. Je li tekst napisan u pozitivnom ili negativnom tonu (tonalitet) i kojim se psihološkim apelima (strah, nada, povjerenje) služi da bi prenio poruku.

```{r}
#| label: analyze-atmosphere
#| include: false

# FAZA 3: ANALIZA ATMOSFERE (SVE NA JEDNOM MJESTU)
# Ovaj chunk uzima obogaćene podatke iz prethodnog koraka i dodaje sve
# metrike atmosfere: Sentiment, Dominantnu Emociju, CLI i RCI.
# Rezultat je jedan, konačni dataframe dta_final za sve vizualizacije.

# Izračun frekvencija riječi
lemmatized_words_with_freq <- nlp_results_df %>%
  count(doc_id, lemma, name = "word_frequency")

# Izračun Sentiment Score-a (CroSentilex-Gold)
sentiment_counts_gold <- lemmatized_words_with_freq %>%
  inner_join(crosentilex_gold_prepared, by = c("lemma" = "word")) %>%
  filter(sentiment_value != 0) %>%
  count(doc_id, sentiment_value) %>%
  pivot_wider(names_from = sentiment_value, values_from = n, values_fill = 0)

if (!"1" %in% names(sentiment_counts_gold)) { sentiment_counts_gold <- sentiment_counts_gold %>% mutate(`1` = 0) }
if (!"-1" %in% names(sentiment_counts_gold)) { sentiment_counts_gold <- sentiment_counts_gold %>% mutate(`-1` = 0) }

document_sentiments_gold <- sentiment_counts_gold %>%
  rename(positive_words = `1`, negative_words = `-1`) %>%
  mutate(sentiment_score_gold = (positive_words - negative_words) / (positive_words + negative_words + 1e-6)) %>%
  select(doc_id, sentiment_score_gold)

# Izračun Dominantne Emocije (NRC)
document_emotions <- lemmatized_words_with_freq %>%
  inner_join(nrc_lexicon_long, by = c("lemma" = "word")) %>%
  group_by(doc_id, emotion) %>%
  summarise(total_freq = sum(word_frequency), .groups="drop") %>%
  group_by(doc_id) %>%
  slice_max(order_by = total_freq, n = 1, with_ties = FALSE) %>%
  ungroup() %>%
  select(doc_id, dominant_emotion = emotion)

# Izračun Indeksa Konflikta (CLI i RCI)
conflict_lexicon <- unique(c(
  (nrc_lexicon_long %>% filter(emotion %in% c("Ljutnja", "Gađenje", "Strah")) %>% pull(word)),
  (crosentilex_full %>% filter(sentiment_value <= -0.75) %>% pull(word)),
  c("laž", "skandal", "napad", "radikalan", "ideologija", "licemjerje", "sramotno", "mržnja", "podjela", "raskol", "manipulacija", "propaganda", "ekstrem", "kontroverz", "sukob", "kriza")
))

cli_scores <- lemmatized_words_with_freq %>%
  mutate(is_conflict = lemma %in% conflict_lexicon) %>%
  group_by(doc_id) %>%
  summarise(
    total_words = sum(word_frequency),
    conflict_words = sum(word_frequency[is_conflict])
  ) %>%
  mutate(cli = (conflict_words / total_words) * 1000) %>% ungroup()

dta_temp <- dta_enriched %>%
  left_join(document_sentiments_gold, by = "doc_id") %>%
  left_join(document_emotions, by = "doc_id") %>%
  left_join(cli_scores %>% select(doc_id, cli), by = "doc_id") %>%
  mutate(
    sentiment_score = ifelse(is.na(sentiment_score_gold), 0, sentiment_score_gold),
    dominant_emotion = ifelse(is.na(dominant_emotion), "Neutralno", dominant_emotion),
    cli = ifelse(is.na(cli), 0, cli)
  )

avg_cli_media <- dta_temp %>% group_by(FROM) %>% summarise(avg_cli_media = mean(cli))
avg_cli_topic <- dta_temp %>% group_by(dominant_topic) %>% summarise(avg_cli_topic = mean(cli))

dta_final <- dta_temp %>%
  left_join(avg_cli_media, by = "FROM") %>%
  left_join(avg_cli_topic, by = "dominant_topic") %>%
  mutate(
    expected_cli = 0.5 * avg_cli_media + 0.5 * avg_cli_topic,
    rci = cli - expected_cli
  )

# Spajanje svega u jedan dataframe za vizualizacije
dta_atmosphere <- dta_enriched %>%
  left_join(document_sentiments_gold, by = "doc_id") %>%
  left_join(document_emotions, by = "doc_id") %>%
  mutate(
    sentiment_score = ifelse(is.na(sentiment_score_gold), 0, sentiment_score_gold),
    dominant_emotion = ifelse(is.na(dominant_emotion), "Neutralno", dominant_emotion)
  )

# Priprema podataka za vizualizaciju
heatmap_data <- dta_atmosphere %>%
  filter(dominant_topic != "Nema Teme") %>%
  group_by(dominant_topic, dominant_emotion) %>%
  summarise(avg_sentiment = mean(sentiment_score),
            n_articles = n(), .groups = "drop") %>%
  ungroup() %>%
  filter(n_articles > 3)
```

### Matrica tona i psihologije

Sljedeća vizualizacija prikazuje kako se tonalitet (boja ćelije) mijenja ovisno o dominantnom psihološkom procesu (stupci) unutar svake teme (redovi). Plave ćelije označavaju pozitivan tonalitet, a crvene negativan, dok desni stupac prikazuje ukupni prosječni sentiment svake teme.

Ova matrica otkriva sofisticirane strategije medijskog uokvirivanja i donosi nekoliko ključnih uvida.

* Kontekst je ključan. Tonalitet teme nije fiksan. Vidljivo je da gotovo sve teme postaju negativne (crvena boja) kada su uokvirene Ljutnjom, Strahom ili Tugom. S druge strane, okviri Povjerenja, Radosti i Iščekivanja gotovo univerzalno proizvode pozitivan tonalitet (plava boja).
* Identifikacija vrućih zona. Teme poput PAPE I VATIKAN i POLITIKA I ODNOS S DRZAVOM pokazuju najveći raspon sentimenata od izrazito negativnih do izrazito pozitivnih. To ih identificira kao ključna bojna polja narativa, gdje je izbor emocionalnog okvira presudan za oblikovanje percepcije publike.
* Paradoks emocija. Najzanimljiviji nalaz je uloga emocije Gađenja. Kada je usmjerena na temu POLITIKE (vjerojatno na korupciju ili nemoral), stvara izrazito pozitivan sentiment, signalizirajući moralnu osudu. Međutim, kada je usmjerena na PAPE I VATIKAN (vjerojatno na unutarcrkvene probleme), stvara najnegativniji sentiment u cijeloj matrici.

Ukratko, ova analiza pokazuje da mediji ne prenose samo informacije već aktivno upravljaju atmosferom oko pojedine teme strateškim odabirom emocionalnog ključa u kojem je predstavljaju.

```{r}
#| label: plot-emotion-heatmap
#| fig-width: 10
#| fig-height: 6

ggplot(heatmap_data, aes(x = dominant_emotion, y = dominant_topic, fill = avg_sentiment)) +
  geom_tile(color = "white", linewidth = 0.5) +
  geom_text(aes(label = round(avg_sentiment, 2)), size = 3, color = "black") +
  scale_fill_gradient2(low = "firebrick", mid = "white", high = "steelblue", midpoint = 0, name = "Prosj. Sentiment") +
  theme_minimal(base_size = 12) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(
    title = "Matrica atmosfere: Kako psihološki okvir utječe na tonalitet teme",
    subtitle = "Boja ćelije predstavlja prosječni sentiment (CroSentilex) unutar svake kombinacije teme i dominantne emocije (NRC)",
    x = "Dominantni psihološki proces (NRC)",
    y = "Dominantna tema"
  )
```

---

## Relativni indeks konflikta (RCI)

Standardna mjerenja ne uzimaju u obzir kontekst. Nije isto koristiti konfliktan jezik u članku o ratu i u članku o duhovnosti. Relativni indeks konflikta (RCI) mjeri koliko je neki članak neočekivano agresivniji ili pomirljiviji od onoga što je uobičajeno za njegov medij i njegovu temu.

```{r}
#| label: rci-calculation
#| include: false

# Izračun CLI-a
cli_scores <- nlp_results_df %>%
  mutate(is_conflict = lemma %in% conflict_lexicon) %>%
  group_by(doc_id) %>%
  summarise(
    cli = (sum(is_conflict) / n()) * 1000
  ) %>% ungroup()

# Spajanje i izračun RCI-a
dta_atmosphere <- dta_enriched %>% 
  left_join(cli_scores, by = "doc_id") %>%
  mutate(cli = ifelse(is.na(cli), 0, cli))

avg_cli_media <- dta_atmosphere %>% group_by(FROM) %>% summarise(avg_cli_media = mean(cli))
avg_cli_topic <- dta_atmosphere %>% group_by(dominant_topic) %>% summarise(avg_cli_topic = mean(cli))

dta_atmosphere_final <- dta_atmosphere %>%
  left_join(avg_cli_media, by = "FROM") %>%
  left_join(avg_cli_topic, by = "dominant_topic") %>%
  mutate(
    expected_cli = 0.5 * avg_cli_media + 0.5 * avg_cli_topic,
    rci = cli - expected_cli
  )
```

### Mapa medijskih strategija konflikta

Sljedeći grafikon koristi RCI mjeru kako bi mapirao medije na temelju njihove strategije korištenja konfliktnog jezika.

* X os: Prosječna, kućna razina konfliktnog jezika medija (CLI). Što je medij više desno, to je njegov ton u prosjeku agresivniji.
* Y os: Varijabilnost (RCI) u korištenju konfliktnog jezika. Što je medij više na grafikonu, to je njegov ton nepredvidljiviji ponekad je miran, a ponekad izrazito agresivan.
* Veličina točke: Ukupna prisutnost medija u diskursu.

Ova mapa otkriva četiri fundamentalno različita modela komunikacije u hrvatskom digitalnom prostoru.

1. Gore desno (strateški eskalatori): Ovdje se nalazi gusta skupina velikih mainstream medija (index.hr, 24sata.hr, dnevnik.hr). Karakterizira ih visok prosječni konflikt i visoka nepredvidivost. Njihova strategija je doziranje konflikta. Koriste ga snažno kada žele privući pažnju na veliku priču, ali su u drugim situacijama umjereniji.
2. Dolje desno (dosljedni kritičari): U ovom kvadrantu grupirani su desno orijentirani i aktivistički portali (narod.hr, dnevno.hr, dragovoljac.com). Njihov ton je konstantno visok u konfliktnosti, ali predvidiv. Oni ne biraju bitke. Njihova je uređivačka politika inherentno konfliktna i kritička.
3. Gore lijevo (pragmatični promatrači): Ovdje nalazimo tradicionalne medije (vecernji.hr, slobodnadalmacija.hr, hrt.hr). Njihov prosječni ton je umjereniji, ali visoka nepredvidivost pokazuje da zadržavaju sposobnost snažne eskalacije konflikta kada procijene da je to potrebno.
4. Dolje lijevo (graditelji zajednic)e: Ovaj prostor pripada vjerskim medijima i YouTube kanalima (hkm.hr, laudato.hr, LaudatoTV). Njihova strategija je dijametralno suprotna ostalima. Dosljedno nizak i predvidiv ton konflikta, s fokusom na informiranje i izgradnju zajednice, a ne na stvaranje prijepora.

```{r}
#| label: plot-rci-strategy
#| fig-width: 10
#| fig-height: 7
#| warning: false
#| message: false

media_strategy_data <- dta_atmosphere_final %>%
  group_by(FROM) %>%
  summarise(
    avg_cli = mean(cli, na.rm = TRUE),
    rci_sd = sd(rci, na.rm = TRUE),
    n_articles = n()
  ) %>%
  ungroup() %>%
  filter(n_articles > 20, !is.na(rci_sd), rci_sd > 0) %>%
  slice_max(order_by = n_articles, n = 30)

ggplot(media_strategy_data, aes(x = avg_cli, y = rci_sd, size = n_articles)) +
  geom_jitter(color = "darkred", alpha = 0.7, width = 0.01, height = 0.01) + 
  geom_text_repel(aes(label = FROM), size = 3.5, max.overlaps = 15) +
  scale_x_log10(labels = scales::number_format(accuracy = 0.1)) +
  scale_y_log10(labels = scales::number_format(accuracy = 0.1)) +
  scale_size_continuous(range = c(2, 10), name = "Broj članaka") +
  theme_minimal(base_size = 14) +
  labs(
    title = "Mapa medijskih strategija konflikta",
    subtitle = "Pozicija medija temeljena na prosječnoj razini i varijabilnosti konfliktnog jezika",
    x = "Prosječni indeks konfliktnog jezika (CLI) Kućni ton (Log skala)",
    y = "Standardna devijacija RCI a Nepredvidivost (Log skala)"
  )
```

---

##  Mreža narativne atmosfere

Konačno, spajamo sve u jednu vizualizaciju. Mreža povezanosti tema prikazuje kako se teme spajaju u šire narativne okvire. Izgled svake veze otkriva atmosferu tih spojeva.

* Boja veze: Prosječni tonalitet (Plavo = pozitivno).
* Debljina veze: Prosječni intenzitet konflikta (Deblje = konfliktnije).
* Prozirnost veze: Pouzdanost veze, tj. broj članaka na kojima se temelji (Tamnije = pouzdanije).

Ova mreža otkriva temeljnu strukturu hrvatskog katoličkog digitalnog prostora.

1. Dva narativna svemira. Mreža nije kaotična. Vidljiva je jasna podjela.
   * Društveno politička arena (lijevi i donji dio): Gusta isprepletenost tema poput POLITIKE, POVIJESTI, BIOETIKE i UNUTARCRKVENIH PRIJEPORA. Veze između ovih tema su izrazito debele, što znači da su visoko konfliktne. Ovo je epicentar svih prijepora i kulturalnih ratova.
   * Pastoralno institucionalna jezgra (gornji i desni dio): Ovdje se nalaze teme DUHOVNOSTI, TEOLOGIJE i CRKVENOG UPRAVLJANJA. Veze unutar ovog klastera i prema njemu su znatno tanje, što upućuje na puno nižu razinu konflikta. Ovo je svijet unutarcrkvenih, doktrinalnih i duhovnih rasprava.

2. Konflikt kao ključni diferencijator. Najiznenađujući nalaz je gotovo potpuno odsustvo negativno obojenih veza. To ne znači da nema kritike, već da je intenzitet konflikta (debljina veze) ključni element koji razlikuje narative. Najdeblje i najtamnije linije koje predstavljaju najpouzdanije i najkonfliktnije narativne spojeve jasno povezuju teme BIOETIKE, POLITIKE, PAPE I VATIKANA i POVIJESTI. Ovo je četverokut prijepora gdje se odvijaju najžešće medijske rasprave.

3. Uloga mostova. Teme poput CRKVENO UPRAVLJANJE i DIGITALNA EVANGELIZACIJA pozicionirane su centralno i služe kao mostovi koji povezuju ova dva svijeta, imajući snažne veze i prema političkom i prema pastoralnom klasteru.

Ukratko, ova mreža je vizualni dokaz postojanja dva različita komunikacijska modela. Jedan koji funkcionira na gorivu visokog konflikta i drugi koji teži mirnom i ne konfliktnom izričaju. Ključne bitke za javno mnijenje vode se na mostovima između ova dva svijeta.

```{r}
#| label: plot-network
#| fig-width: 12
#| fig-height: 10
#| warning: false
#| message: false

# Izračun frekvencija riječi
lemmatized_words_with_freq <- nlp_results_df %>%
  count(doc_id, lemma, name = "word_frequency")

# Izračun Sentiment Score-a
document_sentiments_gold <- lemmatized_words_with_freq %>%
  inner_join(crosentilex_gold_prepared, by = c("lemma" = "word")) %>%
  mutate(
    sentiment_value = as.numeric(sentiment_value),
    word_frequency = as.numeric(word_frequency)
  ) %>%
  group_by(doc_id) %>%
  summarise(sentiment_score_gold = sum(sentiment_value * word_frequency, na.rm = TRUE)) %>%
  ungroup()

# Izračun Indeksa Konfliktnog Jezika (CLI)
conflict_lexicon <- unique(c(
  (nrc_lexicon_long %>% filter(emotion %in% c("Ljutnja", "Gađenje", "Strah")) %>% pull(word)),
  (crosentilex_full %>% filter(sentiment_value <= -0.75) %>% pull(word)),
  c("laž", "skandal", "napad", "radikalan", "ideologija", "licemjerje", "sramotno", "mržnja", "podjela", "raskol", "manipulacija", "propaganda", "ekstrem", "kontroverz", "sukob", "kriza")
))

cli_scores <- lemmatized_words_with_freq %>%
  mutate(is_conflict = lemma %in% conflict_lexicon) %>%
  group_by(doc_id) %>%
  summarise(
    total_words = sum(word_frequency),
    conflict_words = sum(word_frequency[is_conflict])
  ) %>%
  mutate(cli = (conflict_words / total_words) * 1000) %>%
  ungroup()

# Spajanje svih metrika
dta_final <- dta_enriched %>%
  left_join(document_sentiments_gold, by = "doc_id") %>%
  left_join(cli_scores %>% select(doc_id, cli), by = "doc_id") %>%
  mutate(
    sentiment_score_gold = ifelse(is.na(sentiment_score_gold), 0, sentiment_score_gold),
    cli = ifelse(is.na(cli), 0, cli)
  )

# Izračun RCI
avg_cli_media <- dta_final %>% group_by(FROM) %>% summarise(avg_cli_media = mean(cli))
avg_cli_topic <- dta_final %>% group_by(dominant_topic) %>% summarise(avg_cli_topic = mean(cli))

dta_final <- dta_final %>%
  left_join(avg_cli_media, by = "FROM") %>%
  left_join(avg_cli_topic, by = "dominant_topic") %>%
  mutate(
    expected_cli = 0.5 * avg_cli_media + 0.5 * avg_cli_topic,
    rci = cli - expected_cli
  )

# Analiza mreže narativne atmosfere
narrative_pair_data <- dta_final %>%
  select(doc_id, sentiment_score_gold, rci, starts_with("norm_")) %>%
  pivot_longer(
    cols = starts_with("norm_"),
    names_to = "topic",
    values_to = "intensity"
  ) %>%
  mutate(topic = str_remove(topic, "norm_")) %>%
  filter(intensity > 1.5) %>%
  inner_join(., ., by = "doc_id") %>%
  filter(topic.x < topic.y) %>%
  select(doc_id, 
         item1 = topic.x, 
         item2 = topic.y, 
         sentiment_score = sentiment_score_gold.x,
         rci = rci.x)

graph_data <- narrative_pair_data %>%
  group_by(item1, item2) %>%
  summarise(
    n = n(),
    avg_sentiment = mean(sentiment_score, na.rm = TRUE),
    avg_rci = mean(rci, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  filter(n > 10)

set.seed(123)
graph_from_data_frame(graph_data, directed = FALSE) %>%
  ggraph(layout = "fr") +
    geom_edge_fan(
      aes(
        color = avg_sentiment, 
        width = avg_rci,
        alpha = n
      ), 
      arrow = NULL
    ) +
    geom_node_point(color = "black", size = 10) +
    geom_node_text(aes(label = str_wrap(name, 15)), color = "black", size = 3.5) +
    scale_edge_color_gradient2(
      low = "firebrick", mid = "lightgrey", high = "steelblue", midpoint = 0, 
      name="Prosj. sentiment\nnarativnog okvira"
    ) +
    scale_edge_width(
      range = c(1, 4), 
      name="Prosj. intenzitet konflikta (RCI)"
    ) +
    scale_edge_alpha(
      range = c(0.3, 1),
      name = "Broj članaka\n(Pouzdanost veze)"
    ) +
    theme_graph(base_family = "sans") +
    labs(
      title = "Mreža narativne atmosfere",
      subtitle = "Boja veze = tonalitet | Debljina veze = konflikt | Prozirnost veze = pouzdanost"
    )
```

## Zaključak

Dubinska analiza atmosfere katoličkog digitalnog prostora u Hrvatskoj otkrila je kompleksnu sliku koja nadilazi jednostavnu podjelu na pozitivne i negativne teme. Naši nalazi upućuju na postojanje sofisticiranih komunikacijskih strategija i dubokih strukturnih obrazaca u načinu na koji se o vjeri i Crkvi govori u javnosti.

Tri ključna zaključka se ističu.

1. Kontekstualno oblikovanje tonaliteta. Dokazali smo da tonalitet teme nije inherentno svojstvo, već rezultat strateškog emocionalnog uokvirivanja. Isti sadržaj može biti predstavljen kao pozitivan ili negativan ovisno o tome služi li se medij psihološkim apelima na Povjerenje i Radost ili na Ljutnju i Strah. Ovo potvrđuje da mediji nisu samo pasivni prenositelji informacija, već aktivni kreatori atmosfere.

2. Četiri modela komunikacije. Identificirali smo četiri fundamentalno različite medijske strategije u korištenju konfliktnog jezika, koje grubo odgovaraju tipologiji medija.
   * Strateški eskalatori (mainstream mediji) koji doziraju konflikt.
   * Dosljedni kritičari (aktivistički portali) koji ga koriste kao temeljni dio svog identiteta.
   * Pragmatični promatrači (tradicionalni mediji) koji ga koriste uravnoteženo.
   * Graditelji zajednice (vjerski mediji) koji ga sustavno izbjegavaju.

3. Dva svemira diskursa. Najvažniji nalaz, vizualiziran u Mreži narativne atmosfere, jest postojanje dva jasno odvojena tematska i atmosferska svijeta. Jedan je društveno politički, obilježen visokim intenzitetom konflikta i ispreplitanjem tema politike, povijesti i bioetike. Drugi je pastoralno institucionalni, karakteriziran niskim konfliktom i fokusom na duhovnost i unutarcrkvena pitanja.

Ovi nalazi pokazuju da je za razumijevanje digitalnog prostora nužno koristiti višeslojne, kontekstualno svjesne metode koje mogu razotkriti suptilne komunikacijske strategije koje oblikuju javnu percepciju Crkve i vjere u Hrvatskoj.

Budući koraci ovog istraživanja usmjerit će se na povezivanje ovih nalaza s konkretnim događajima (Event Detection) te na finiju analizu specifičnih narativa i fraza koje se koriste unutar najkonfliktnijih tema. Krajnji cilj ostaje stvaranje dinamičnog digitalnog opservatorija koji će u stvarnom vremenu moći pratiti i analizirati puls ovih važnih društvenih rasprava.
