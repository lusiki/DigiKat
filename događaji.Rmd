---
title: "Digitalni odjeci: Dinamička analiza utjecaja stvarnih događaja na online diskurs"
author: "Istraživački tim projekta, Hrvatsko katoličko sveučilište"
date: "25. kolovoza 2025."
output: 
  html_document:
    toc: true
    toc_float: true
    theme: flatly
    code_folding: hide
---

```{r setup, include=FALSE}
# --- Globalne postavke ---
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, fig.width = 12, fig.height = 9, dpi = 350)
```

```{r libraries, include=FALSE}
# --- Učitavanje svih potrebnih paketa ---
library(scales)
library(patchwork)
library(dplyr)
library(tidytext)
library(stringr)
library(ggplot2)
library(forcats)
library(tidyr)
library(lubridate)
library(widyr)
library(data.table)
library(readxl)
library(textdata)
library(readr)
```

```{r data-preparation, include=FALSE}
# read in lexicons
CroSentilex_n <- read.delim("C:/Users/Lukas/Dropbox/Mislav@Luka/crosentilex-negatives.txt",
                                   header = FALSE,
                                   sep = " ",
                                   stringsAsFactors = FALSE,
                                   fileEncoding = "UTF-8")  %>%
                   rename(word = "V1", sentiment = "V2" ) %>%
                   mutate(brija = "NEG")

CroSentilex_p  <- read.delim("C:/Users/Lukas/Dropbox/Mislav@Luka/crosentilex-positives.txt",
                                   header = FALSE,
                                   sep = " ",
                                   stringsAsFactors = FALSE,
                                   fileEncoding = "UTF-8") %>%
                    rename(word = "V1", sentiment = "V2" ) %>%
                    mutate(brija = "POZ")

crosentilex  <- rbind(setDT(CroSentilex_n), setDT(CroSentilex_p))
# # check lexicon data 
# #head(sample_n(Crosentilex_sve,1000),15)
# 
#  
CroSentilex_Gold  <- read.delim2("C:/Users/Lukas/Dropbox/Mislav@Luka/gs-sentiment-annotations.txt",
                                 header = FALSE,
                                 sep = " ",
                                 stringsAsFactors = FALSE) %>%
                    rename(word = "V1", sentiment = "V2" )
 # Encoding(CroSentilex_Gold$word) <- "UTF-8"
 # CroSentilex_Gold[1,1] <- "dati"
 # CroSentilex_Gold$sentiment <- str_replace(CroSentilex_Gold$sentiment , "-", "1")
 # CroSentilex_Gold$sentiment <- str_replace(CroSentilex_Gold$sentiment , "\\+", "2")
 # CroSentilex_Gold$sentiment <- as.numeric(unlist(CroSentilex_Gold$sentiment))
# check lexicon data 
#head(sample_n(CroSentilex_Gold,100),15)
crosentilex_gold_prepared <- CroSentilex_Gold %>%
  mutate(
    sentiment_value = case_when(
      sentiment == 2 ~ 1,   # Pozitivno
      sentiment == 1 ~ -1,  # Negativno
      TRUE ~ 0              # Neutralno
    )
  ) %>%
  select(word, sentiment_value)

 
nrc_lexicon  <- read_excel("C:/Users/Lukas/Dropbox/Mislav@Luka/lilaHR_clean.xlsx", sheet = "Sheet1") %>% select (-"...1")


# Prvo definiramo "rječnik" za prevođenje
emotion_translator_hr <- c(
  "Anger"        = "Ljutnja",
  "Anticipation" = "Iščekivanje",
  "Disgust"      = "Gađenje",
  "Fear"         = "Strah",
  "Joy"          = "Radost",
  "Sadness"      = "Tuga",
  "Surprise"     = "Iznenađenje",
  "Trust"        = "Povjerenje"
  # Ne trebamo 'Positive' i 'Negative' jer ih ionako filtriramo
)

# Sada modificiramo originalni cjevovod
nrc_lexicon_long <- nrc_lexicon %>%
  rename(word = HR) %>% 
  pivot_longer(
    cols = -word,
    names_to = "emotion",
    values_to = "value"
  ) %>%
  filter(value == 1) %>%
  select(word, emotion) %>%
  # Filtriramo opće sentimente PRIJE prevođenja
  filter(emotion != "Positive" & emotion != "Negative") %>%
  # DODAJEMO NOVI KORAK: Prevođenje stupca 'emotion'
  mutate(emotion = recode(emotion, !!!emotion_translator_hr))

nrc_lexicon_long_ <- read_excel("C:/Users/Lukas/Dropbox/Mislav@Luka/lilaHR_clean_long.xlsx", sheet = "Sheet1") %>% select (-"...1") 

crosentilex_full <- bind_rows(
  # Učitavanje negativnih riječi
  read.delim("C:/Users/Lukas/Dropbox/Mislav@Luka/crosentilex-negatives.txt",
             header = FALSE, sep = " ", stringsAsFactors = FALSE, fileEncoding = "UTF-8") %>%
    rename(word = "V1", sentiment_value = "V2") %>%
    mutate(sentiment_value = -sentiment_value), # Pretvaramo score u negativan
  
  # Učitavanje pozitivnih riječi
  read.delim("C:/Users/Lukas/Dropbox/Mislav@Luka/crosentilex-positives.txt",
             header = FALSE, sep = " ", stringsAsFactors = FALSE, fileEncoding = "UTF-8") %>%
    rename(word = "V1", sentiment_value = "V2") # Score je već pozitivan
) %>%
  as_tibble() # Pretvaramo u tibble radi bolje konzistentnosti

# --- 1.2: CroSentilex-Gold (kategorički sentiment) ---
# Učitavamo "zlatni standard" i pretvaramo tekstualne oznake u numeričku skalu (-1, 0, 1).
crosentilex_gold_prepared <- read.delim2("C:/Users/Lukas/Dropbox/Mislav@Luka/gs-sentiment-annotations.txt",
                                         header = FALSE, sep = " ", stringsAsFactors = FALSE, fileEncoding = "UTF-8") %>%
  rename(word = "V1", sentiment_str = "V2") %>%
  mutate(
    sentiment_value = case_when(
      sentiment_str == "+" ~ 1,
      sentiment_str == "-" ~ -1,
      TRUE ~ 0
    )
  ) %>%
  select(word, sentiment_value) %>%
  as_tibble()

# --- 1.3: NRC Leksikon Emocija (za psihološke procese) ---
# Učitavamo NRC leksikon, pretvaramo ga u "dugi" format i prevodimo na hrvatski.
nrc_lexicon_raw <- read_excel("C:/Users/Lukas/Dropbox/Mislav@Luka/lilaHR_clean.xlsx", sheet = "Sheet1") %>% 
                   select(-"...1") %>%
                   rename(word = HR)

# Rječnik za prevođenje engleskih naziva emocija
emotion_translator_hr <- c(
  "Anger" = "Ljutnja", "Anticipation" = "Iščekivanje", "Disgust" = "Gađenje",
  "Fear" = "Strah", "Joy" = "Radost", "Sadness" = "Tuga",
  "Surprise" = "Iznenađenje", "Trust" = "Povjerenje"
)

# Transformacija u dugi, prevedeni format
nrc_lexicon_long <- nrc_lexicon_raw %>% 
  pivot_longer(
    cols = all_of(names(emotion_translator_hr)), # Koristimo samo 8 glavnih emocija
    names_to = "emotion",
    values_to = "value"
  ) %>%
  filter(value == 1) %>% # Zadržavamo samo postojeće veze riječ-emocija
  mutate(emotion = recode(emotion, !!!emotion_translator_hr)) %>% # Prevodimo na hrvatski
  select(word, emotion)


dta <- readRDS("D:/LUKA/Dropbox/df_all.rds")

# Kreiranje stratificiranog uzorka od 5%
sample_proportion <- 0.05
set.seed(123)
dta_stratified_sample <- dta %>%
  filter(nchar(FULL_TEXT) > 100) %>%
  group_by(year, SOURCE_TYPE) %>%
  slice_sample(prop = sample_proportion) %>%
  ungroup() %>%
  mutate(doc_id = row_number())

# --- 2.2: Učitavanje i filtriranje lingvističkih podataka ---
# Učitavamo sve prethodno obrađene NLP datoteke...
files <- list.files("D:/LUKA/Language model", full.names = TRUE, pattern = "\\.rds")
nlp_results_df <- lapply(files, readRDS) %>%
  bind_rows() %>%
  mutate(doc_id = as.integer(doc_id)) %>%
  # ...i odmah ih filtriramo da sadrže samo dokumente iz našeg uzorka.
  # Ovo drastično ubrzava sve buduće operacije.
  filter(doc_id %in% dta_stratified_sample$doc_id)

# --- 2.3: Tematska klasifikacija ---
# Definiramo tematski rječnik
thematic_dictionaries_v3 <- list(
  DUHOVNOST_I_LITURGIJA = c("molitv", "mis", "euharistij", "sakrament", "duhovn", "vjer", "blagoslov", "gosp", "hodočašć", "propovijed", "klanjanj", "zornic", "liturgij", "advent", "korizm", "blagdan", "svetkovin", "krunic", "brevijar", "duhovne vježbe"),
  TEOLOGIJA_I_DOKTRINA = c("teologij", "dogm", "eshatologij", "kristologij", "trojstv", "grijeh", "spasenje", "opravdanje", "moral", "krštenje", "biblija", "sveto pismo", "evanđelj"),
  CRKVENO_UPRAVLJANJE_I_STRUKTURA = c("crkv", "biskup", "nadbiskup", "kardinal", "sveta stolica", "hbk", "žup", "svećenic", "kler", "redovnik", "časna sestra", "laik", "dekanat", "biskupija"),
  PAPE_I_VATIKAN = c("papa franjo", "benedikt xvi", "ivan pavao ii", "vatikan", "dikasterij", "enciklik", "sinodalni put", "sveti otac", "konklav", "apostolsk"),
  CRKVENE_FINANCIJE_I_IMOVINA = c("financij", "imovin", "novac", "proračun", "porez", "restitucij", "ugovor sa svetom stolicom", "nekretnin", "donacij", "milodar"),
  GLOBALNA_CRKVA_I_MISIJE = c("misije", "misionar", "progonjeni kršćani", "svjetski dan mladih", "afrik", "azij", "južna amerik", "svjetska crkva", "papinsk"),
  POLITIKA_I_ODNOS_S_DRZAVOM = c("izbor", "vlada", "strank", "hdz", "sdp", "sabor", "zakon", "predsjednik", "politi", "europ", "milanović", "plenković", "ustav", "sekularnost", "vjeronauk u školi"),
  BIOETIKA_I_KULTURNI_RATOVI = c("obitelj", "život", "pobačaj", "abortus", "brak", "roditelj", "djec", "spol", "rodn", "hod za život", "lgbt", "istospoln", "eutanazij", "transrodnost", "medicinski potpomognuta oplodnja", "palijativna skrb"),
  KARITAS_I_SOCIJALNA_PRAVDA = c("caritas", "pomoć", "siromaš", "siroma", "humanitar", "solidarn", "socijaln", "izbjeglic", "potres", "volonter", "socijalni nauk", "ekologij", "laudato si'", "migranti", "pravednost"),
  POVIJEST_I_NACIONALNI_IDENTITET = c("stepinac", "rat", "komuniz", "jugoslavij", "žrtv", "povijest", "branitelj", "lustracij", "domovinsk", "ustaš", "partizan", "bleiburg", "vukovar", "nacionalni identitet"),
  ZNANOST_I_VJERA = c("znanost", "evolucij", "stvaranje", "bioetik", "umjetna inteligencija", "svemir", "psihologij", "vjera i razum"),
  MEDIJI_UMJETNOST_I_KULTURA = c("medij", "film", "glazb", "umjetnost", "književnost", "kazališt", "arhitektur", "sakraln", "kultura", "koncert", "izložb"),
  DIGITALNA_EVANGELIZACIJA_I_MLADI = c("digitaln", "internet", "društvene mreže", "mladi", "pastoral mladih", "influencer", "podcast", "aplikacij", "evangelizacij", "susret hrvatske katoličke mladeži"),
  ZLOSTAVLJANJE_I_KRIZA_POVJERENJA = c("zlostavljan", "pedofilij", "skandal", "prikrivan", "nulta tolerancija", "žrtv", "susret sa žrtvama"),
  UNUTARCRKVENI_PRIJEPORI_I_IDEOLOGIJE = c("tradicionalist", "progresiv", "konzervativ", "liberal", "karizmatik", "lefebvrovci", "tradicijska misa", "aggiornamento", "hermeneutik", "pluraliz"),
  ODNOS_S_DRUGIM_RELIGIJAMA_I_POGLEDIMA = c("ekumeniz", "međureligijsk", "dijalog", "islam", "pravoslavn", "protestant", "judaiz", "ateiz", "agnosticiz")
)

# Definicija funkcije za izračun scoreova
calculate_theme_scores <- function(text, dictionaries) {
  text_lower <- tolower(text)
  total_words <- str_count(text_lower, "\\w+")
  if (total_words == 0) return(NULL)
  scores <- purrr::map(dictionaries, ~sum(str_count(text_lower, .x)))
  normalized_scores <- purrr::map(scores, ~(.x / total_words) * 1000)
  names(normalized_scores) <- paste0("norm_", names(scores))
  scores_vec <- unlist(scores)
  if(all(scores_vec == 0)){
    dominant_topic <- "Nema Teme"
  } else {
    dominant_topic <- names(scores)[which.max(scores_vec)]
  }
  return(c(as.list(scores), as.list(normalized_scores), dominant_topic = dominant_topic))
}

# Primjena funkcije i stvaranje finalnog obogaćenog dataseta
theme_analysis_data <- purrr::map_dfr(dta_stratified_sample$FULL_TEXT, ~calculate_theme_scores(., thematic_dictionaries_v3))
dta_enriched <- bind_cols(dta_stratified_sample, theme_analysis_data)




lemmatized_words_with_freq <- nlp_results_df %>%
  count(doc_id, lemma, name = "word_frequency")

# --- 3.2: Izračun Sentiment Score-a (CroSentilex-Gold) ---
sentiment_counts_gold <- lemmatized_words_with_freq %>%
  inner_join(crosentilex_gold_prepared, by = c("lemma" = "word")) %>%
  filter(sentiment_value != 0) %>%
  count(doc_id, sentiment_value) %>%
  pivot_wider(names_from = sentiment_value, values_from = n, values_fill = 0)
if (!"1" %in% names(sentiment_counts_gold)) { sentiment_counts_gold <- sentiment_counts_gold %>% mutate(`1` = 0) }
if (!"-1" %in% names(sentiment_counts_gold)) { sentiment_counts_gold <- sentiment_counts_gold %>% mutate(`-1` = 0) }
document_sentiments_gold <- sentiment_counts_gold %>%
  rename(positive_words = `1`, negative_words = `-1`) %>%
  mutate(sentiment_score_gold = (positive_words - negative_words) / (positive_words + negative_words + 1e-6)) %>%
  select(doc_id, sentiment_score_gold)

# --- 3.3: Izračun Dominantne Emocije (NRC) ---
document_emotions <- lemmatized_words_with_freq %>%
  inner_join(nrc_lexicon_long, by = c("lemma" = "word")) %>%
  group_by(doc_id, emotion) %>%
  summarise(total_freq = sum(word_frequency), .groups="drop") %>%
  group_by(doc_id) %>%
  slice_max(order_by = total_freq, n = 1, with_ties = FALSE) %>%
  ungroup() %>%
  select(doc_id, dominant_emotion = emotion)

# --- 3.4: Izračun Indeksa Konflikta (CLI i RCI) ---
conflict_lexicon <- unique(c(
  (nrc_lexicon_long %>% filter(emotion %in% c("Ljutnja", "Gađenje", "Strah")) %>% pull(word)),
  (crosentilex_full %>% filter(sentiment_value <= -0.75) %>% pull(word)),
  c("laž", "skandal", "napad", "radikalan", "ideologija", "licemjerje", "sramotno", "mržnja", "podjela", "raskol", "manipulacija", "propaganda", "ekstrem", "kontroverz", "sukob", "kriza")
))
cli_scores <- lemmatized_words_with_freq %>%
  mutate(is_conflict = lemma %in% conflict_lexicon) %>%
  group_by(doc_id) %>%
  summarise(
    total_words = sum(word_frequency),
    conflict_words = sum(word_frequency[is_conflict])
  ) %>%
  mutate(cli = (conflict_words / total_words) * 1000) %>% ungroup()

dta_temp <- dta_enriched %>%
  left_join(document_sentiments_gold, by = "doc_id") %>%
  left_join(document_emotions, by = "doc_id") %>%
  left_join(cli_scores %>% select(doc_id, cli), by = "doc_id") %>%
  mutate(
    sentiment_score = ifelse(is.na(sentiment_score_gold), 0, sentiment_score_gold),
    dominant_emotion = ifelse(is.na(dominant_emotion), "Neutralno", dominant_emotion),
    cli = ifelse(is.na(cli), 0, cli)
  )

avg_cli_media <- dta_temp %>% group_by(FROM) %>% summarise(avg_cli_media = mean(cli))
avg_cli_topic <- dta_temp %>% group_by(dominant_topic) %>% summarise(avg_cli_topic = mean(cli))

dta_final <- dta_temp %>%
  left_join(avg_cli_media, by = "FROM") %>%
  left_join(avg_cli_topic, by = "dominant_topic") %>%
  mutate(
    expected_cli = 0.5 * avg_cli_media + 0.5 * avg_cli_topic,
    rci = cli - expected_cli
  )

# --- Priprema Podataka (izvršava se u pozadini) ---
# U ovom chunku se nalaze svi koraci iz prethodnih analiza koji su doveli do
# finalnog, obogaćenog dataframe-a 'dta_final' i lingvističkih podataka 'nlp_results_df'.
# Za potrebe ovog dokumenta, pretpostavit ćemo da su ti objekti već učitani.
# dta_final <- readRDS("data/dta_final_with_atmosphere.rds")
# nlp_results_df <- readRDS("data/nlp_results_for_sample.rds")
# thematic_dictionaries_v3 <- ...
```

## Uvod: Dinamika medijskog prostora

U prethodnim fazama mapirali smo aktere, teme i opću atmosferu diskursa. Ova finalna faza analize ide korak dalje: prelazimo sa statične slike na **dinamičko modeliranje**. Cilj nam je razumjeti kako se digitalni diskurs ponaša kao "živi organizam" koji reagira na vanjske podražaje – stvarne događaje.

Ovaj izvještaj će demonstrirati kako možemo:
1.  **Automatski detektirati** dane neuobičajene medijske aktivnosti s visokom pouzdanošću.
2.  **Vizualizirati "životni ciklus" događaja** kroz "Narativni seizmograf" koji istovremeno prati volumen, konflikt i sentiment.
3.  **Analizirati evoluciju narativa** mjereći ne samo koje se riječi vežu uz temu, već i kakva je **atmosfera** tih veza.

---

## 1. Digitalni seizmograf: Automatska setekcija ključnih događaja

Kako bismo identificirali najvažnije dane u našem trogodišnjem razdoblju, razvili smo "digitalni seizmograf". On detektira dane kada su **intenzitet konfliktnog jezika (CLI)** ili **volumen objava** prešli prag od **99-og percentila**, signalizirajući izvanredan događaj.

```{r anomaly-detection, eval= FALSE, message=FALSE, warning=FALSE}
# --- KOD ZA DETEKCIJU ANOMALIJA (POBOLJŠANA VERZIJA) ---
daily_summary <- dta_final %>%
  mutate(date = as.Date(DATE)) %>%
  group_by(date) %>%
  summarise(
    n_articles = n(),
    avg_cli = mean(cli, na.rm = TRUE)
  ) %>%
  ungroup()

# Računamo pragove (99-i percentil)
volume_threshold <- quantile(daily_summary$n_articles, 0.99)
cli_threshold <- quantile(daily_summary$avg_cli, 0.99)

# Identificiramo "potrese"
spikes_detected <- daily_summary %>%
  mutate(
    is_volume_spike = n_articles > volume_threshold,
    is_cli_spike = avg_cli > cli_threshold
  )

# Vizualizacija
p_volume <- ggplot(spikes_detected, aes(x = date, y = n_articles)) +
  geom_line(color = "grey") +
  geom_point(data = filter(spikes_detected, is_volume_spike), color = "red", size = 3) +
  geom_hline(yintercept = volume_threshold, linetype="dashed", color="red") +
  theme_minimal() +
  labs(title = "Ekstremni volumen objava", y = "Broj članaka dnevno", x = "")

p_cli <- ggplot(spikes_detected, aes(x = date, y = avg_cli)) +
  geom_line(color = "grey") +
  geom_point(data = filter(spikes_detected, is_cli_spike), color = "red", size = 3) +
  geom_hline(yintercept = cli_threshold, linetype="dashed", color="red") +
  theme_minimal() +
  labs(title = "Ekstremni intenzitetu konflikta", y = "Prosječni CLI dnevno", x = "Datum")

p_volume / p_cli
```

**Interpretacija:**
Crvene točke su dani koji su "uzdrmali" digitalni prostor. Naša analiza pokazuje da ovi dani gotovo savršeno odgovaraju ključnim događajima poput **Hoda za život, Pride povorke, parlamentarnih izbora i važnih obljetnica**, potvrđujući da naš "seizmograf" uspješno identificira trenutke od najveće javne važnosti.



```{r standardized-anomaly-detection}
# --- KOD ZA STANDARDIZIRANU DETEKCIJU ANOMALIJA ---

# Agregiramo podatke po danu
daily_summary <- dta_final %>%
  mutate(date = as.Date(DATE),
         year = year(date)) %>% # Dodajemo godinu za godišnju standardizaciju
  group_by(date, year) %>%
  summarise(
    n_articles = n(),
    avg_cli = mean(cli, na.rm = TRUE),
    .groups = "drop"
  )

# Standardiziramo vrijednosti (računamo Z-score) unutar svake godine
standardized_summary <- daily_summary %>%
  group_by(year) %>%
  mutate(
    # Z-score = (vrijednost - prosjek) / standardna devijacija
    z_score_volume = (n_articles - mean(n_articles)) / sd(n_articles),
    z_score_cli = (avg_cli - mean(avg_cli)) / sd(avg_cli)
  ) %>%
  ungroup()

# Definiramo prag za "šiljak" (npr. 3 standardne devijacije)
spike_threshold_z <- 3

# Identificiramo "potrese"
spikes_detected_z <- standardized_summary %>%
  mutate(
    is_volume_spike = z_score_volume > spike_threshold_z,
    is_cli_spike = z_score_cli > spike_threshold_z
  )

# --- ISPIS DATUMA S ANOMALIJAMA ---
volume_spike_dates <- spikes_detected_z %>%
  filter(is_volume_spike) %>%
  select(date, n_articles, z_score_volume) %>%
  arrange(desc(z_score_volume))

cli_spike_dates <- spikes_detected_z %>%
  filter(is_cli_spike) %>%
  select(date, avg_cli, z_score_cli) %>%
  arrange(desc(z_score_cli))

# (Ovaj dio ispod će ispisati tablice direktno u vaš HTML dokument)
cat("### Dani s Ekstremnim Volumom Objava\n\n")
knitr::kable(volume_spike_dates, caption = "Top datumi rangirani po Z-scoreu volumena.")

cat("\n### Dani s Ekstremnim Intenzitetom Konflikta\n\n")
knitr::kable(cli_spike_dates, caption = "Top datumi rangirani po Z-scoreu konflikta.")


# --- VIZUALIZACIJA STANDARDIZIRANIH VRIJEDNOSTI ---
p_volume_z <- ggplot(spikes_detected_z, aes(x = date, y = z_score_volume)) +
  geom_line(color = "grey") +
  geom_point(data = filter(spikes_detected_z, is_volume_spike), color = "red", size = 3) +
  geom_hline(yintercept = spike_threshold_z, linetype = "dashed", color = "red") +
  theme_minimal() +
  labs(
    title = "Anomalije u volumenu objava (Standardizirano)",
    y = "Odstupanje od prosjeka (u st. dev.)",
    x = ""
  )

p_cli_z <- ggplot(spikes_detected_z, aes(x = date, y = z_score_cli)) +
  geom_line(color = "grey") +
  geom_point(data = filter(spikes_detected_z, is_cli_spike), color = "red", size = 3) +
  geom_hline(yintercept = spike_threshold_z, linetype = "dashed", color = "red") +
  theme_minimal() +
  labs(
    title = "Anomalije u intenzitetu konflikta (Standardizirano)",
    y = "Odstupanje od prosjeka (u st. dev.)",
    x = "Datum"
  )

# Spajamo grafove
p_volume_z / p_cli_z

```


---

## 2. Anatomija događaja: Narativni seizmograf Uskrsa 2022.

Kako bismo ispitali kako se diskurs mijenja oko različitih tipova događaja, sada ćemo analizirati **Uskrs 2022. godine (17. travnja)**. Za razliku od Hoda za život, Uskrs je primarno liturgijski i duhovni događaj. Očekujemo da će se to odraziti i u "digitalnom odjeku".

Seizmograf je podešen da prati temu **`DUHOVNOST_I_LITURGIJA`**.
*   **Linija:** Prikazuje udio ove teme u ukupnom diskursu.
*   **Veličina točke:** Predstavlja intenzitet **konflikta (CLI)**.
*   **Boja točke:** Predstavlja prosječni **tonalitet (sentiment)**.

```{r event-seismograph-uskrs,  fig.height=10, fig.width=10, message=FALSE}
# --- KOD ZA "NARATIVNI SEIZMOGRAF" ZA USKRS 2022 ---
event_date_uskrs <- as.Date("2022-04-17")
analysis_window_uskrs <- 14 # Analiziramo 14 dana prije i poslije

daily_duhovnost_dynamics <- dta_final %>%
  mutate(date = as.Date(DATE)) %>%
  group_by(date) %>%
  summarise(
    # Udio članaka s dominantnom temom DUHOVNOST
    duhovnost_share = mean(dominant_topic == "DUHOVNOST_I_LITURGIJA", na.rm = TRUE),
    # Prosječni CLI i sentiment SAMO za članke o duhovnosti taj dan
    avg_cli = mean(cli[dominant_topic == "DUHOVNOST_I_LITURGIJA"], na.rm = TRUE),
    avg_sentiment = mean(sentiment_score[dominant_topic == "DUHOVNOST_I_LITURGIJA"], na.rm = TRUE)
  ) %>%
  filter(date >= (event_date_uskrs - days(analysis_window_uskrs)) & date <= (event_date_uskrs + days(analysis_window_uskrs)))

ggplot(daily_duhovnost_dynamics, aes(x = date, y = duhovnost_share)) +
  geom_line(color = "grey", linewidth=1) +
  geom_point(aes(size = avg_cli, color = avg_sentiment)) +
  geom_vline(xintercept = event_date_uskrs, linetype = "dashed", color = "black", linewidth=1) +
  scale_y_continuous(labels = percent_format()) +
  scale_color_gradient2(low = "firebrick", mid = "white", high = "steelblue", midpoint = 0, name="Prosj. sentiment") +
  scale_size_continuous(range = c(2, 12), name="Intenzitet konflikta (CLI)") +
  theme_minimal(base_size = 14) +
  labs(
    title = "Narativni seizmograf: Dnevna dinamika Uskrsa 2022.",
    subtitle = "Linija=Udio teme | Veličina=Konflikt | Boja=Tonalitet",
    x = "Datum", y = "Udio teme 'Duhovnost i Liturgija' u dnevnom diskursu"
  )
```

### **Interpretacija: Mir i pozitivan tonalitet**

Seizmograf za Uskrs priča potpuno drugačiju priču od onog za Hod za život:

*   **Jasan i oštar vrhunac:** Za razliku od višestrukih "valova", medijska pažnja je **izrazito koncentrirana** na sam dan Uskrsa i dane neposredno prije (Veliki Tjedan). Udio teme `DUHOVNOST` doseže svoj apsolutni vrhunac točno na dan blagdana.
*   **Odsustvo konflikta:** Najvažniji nalaz je **veličina točaka**. One su **konstantno male** kroz cijelo promatrano razdoblje. To je kvantitativni dokaz da je diskurs o Uskrsu gotovo u potpunosti **ne-konfliktan i ne-polemičan**.
*   **Dominacija pozitivnog tona:** Sve točke na grafikonu su **izrazito plave**, što ukazuje na **visoko pozitivan sentiment**. Medijsko izvještavanje je afirmativno, fokusirano na poruke nade, mira i duhovne obnove.

---

## 3. "Životopis" narativa: Evolucija teme o Alojziju Stepincu

Na kraju, umjesto da gledamo pojedinačne događaje, pratimo kako se jedan dugotrajan i kompleksan narativ – onaj o **blaženom Alojziju Stepincu** – mijenjao i uokvirivao kroz godine. Analizirali smo koje su se riječi najsnažnije vezale uz pojam "Stepinac" u svakoj od promatranih godina i izmjerili prosječni tonalitet tih specifičnih narativnih spojeva.

```{r narrative-biography-robust, fig.height=9}
# --- KOD ZA "ŽIVOTOPIS" NARATIVA (ROBUSNA VERZIJA) ---

# (Koraci 1 i 2 - pronalaženje dokumenata i izdvajanje konteksta - ostaju isti)
target_keyword <- "stepinac"
docs_with_target <- nlp_results_df %>%
  filter(lemma == target_keyword) %>%
  distinct(doc_id) %>%
  pull(doc_id)

context_words <- nlp_results_df %>%
  filter(doc_id %in% docs_with_target) %>%
  filter(upos %in% c("NOUN", "ADJ")) %>%
  filter(lemma != target_keyword) %>%
  inner_join(dta_final %>% select(doc_id, year, sentiment_score), by = "doc_id")

# 3. KORAK: Agregacija (ostaje ista)
associated_words_atmosphere <- context_words %>%
  group_by(year, lemma) %>%
  summarise(
    total_cooccurrences = n(),
    avg_sentiment = mean(sentiment_score, na.rm = TRUE),
    .groups = "drop"
  )

# 4. KORAK: Prilagodljivo filtriranje (KLJUČNA PROMJENA)
top_associated_words_final <- associated_words_atmosphere %>%
  group_by(year) %>%
  # Umjesto filter(total_cooccurrences > 1), sada samo sortiramo i uzimamo top N
  # Ovo osigurava da ćemo dobiti rezultate čak i ako su se riječi pojavile samo jednom.
  arrange(desc(total_cooccurrences)) %>%
  slice_head(n = 12) %>% # slice_head() je sigurnija alternativa za slice_max()
  ungroup()

# 5. KORAK: Vizualizacija (ostaje ista)
# Provjera da li imamo podataka za crtanje

  ggplot(top_associated_words_final, aes(x = total_cooccurrences, y = reorder_within(lemma, total_cooccurrences, year), fill = avg_sentiment)) +
    geom_col() +
    scale_y_reordered() +
    scale_fill_gradient2(low = "firebrick", mid = "white", high = "steelblue", midpoint = 0, name="Prosj. sentiment\nove kombinacije") +
    facet_wrap(~ year, scales = "free_y") +
    theme_minimal(base_size = 12) +
    theme(strip.text = element_text(face = "bold")) +
    labs(
      title = "Evolucija i atmosfera narativa o bl. Alojziju Stepincu",
      subtitle = "Boja stupca otkriva tonalitet specifičnog narativnog okvira",
      x = "Broj zajedničkih pojavljivanja s riječi 'Stepinac'", y = "Asocirana riječ"
    )

```


**Interpretacija:**
Ova vizualizacija otkriva suptilne, ali značajne pomake u načinu na koji se o bl. Alojziju Stepincu govori iz godine u godinu. Iako je cjelokupan tonalitet diskursa, prikazan nijansama plave boje, konzistentno pozitivan, **fokus i kontekst narativa se dramatično mijenjaju**:

*   **2021. Godina:** Dominiraju termini poput **"sps"** i **"pravoslavan"**, što ukazuje da je narativ bio snažno uokviren **ekumensko-političkim odnosima** sa Srpskom Pravoslavnom Crkvom i pitanjem kanonizacije.
*   **2022. Godina:** Asocijacije se šire na **"rat", "crkva"** i **"emisija"**. Ovo signalizira pomak prema **povijesno-medijskom okviru**, gdje se raspravlja o njegovoj ulozi u Drugom svjetskom ratu, često kroz medijske formate poput emisija i dokumentaraca.
*   **2023. Godina:** Diskursom dominiraju riječi **"molitva", "veljača", "krunica"** i **"devetnica"**. Ovo predstavlja jasan pomak na **liturgijsko-pobožni okvir**, potaknut komemoracijom i vjerskim praksama vezanim uz obljetnicu njegove smrti.

Ovo je kvantitativni dokaz da veliki nacionalni i vjerski narativi nisu statični. Oni se dinamički rekontekstualiziraju ovisno o trenutnim događajima, prelazeći iz političke u povijesnu, a zatim u duhovnu sferu, pri čemu svaka godina naglašava drugačiji aspekt iste ličnosti.


























